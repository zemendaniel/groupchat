<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:gui="clr-namespace:groupchat.gui"
        x:Class="groupchat.gui.MainWindow"
        Width="800" Height="600"
        Title="Group Chat"
        Background="Black"
        SystemDecorations="None"
        CanResize="True"
        FontFamily="{StaticResource SpaceMonoFont}">

    <Grid RowDefinitions="Auto,*">
        <Border Background="#222" Height="30" PointerPressed="TitleBar_PointerPressed">
            <Grid ColumnDefinitions="*,Auto,Auto, Auto">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="6">
                    <Image Width="16" Height="16" Source="avares://groupchat.gui/Assets/sigma.png" VerticalAlignment="Center" Margin="2 0"/>
                    <TextBlock Text="Group Chat" VerticalAlignment="Center" 
                               Foreground="White" FontWeight="DemiBold" Margin="4,0,0,0"/>
                </StackPanel>
                
                <!-- Minimize button -->
                <Button Grid.Column="2" Width="28" Height="28" 
                        VerticalAlignment="Center" HorizontalAlignment="Center"
                        Background="Transparent" BorderBrush="Transparent"
                        Click="MinimizeButtonClick" FontWeight="Bold">
                    <TextBlock Text="-" HorizontalAlignment="Center" VerticalAlignment="Center" 
                               FontSize="16" Foreground="White"/>
                    <Button.Styles>
                        <Style Selector="Button:hover">
                            <Setter Property="Background" Value="#444"/> 
                        </Style>
                    </Button.Styles>
                </Button>
                <Button Grid.Column="3" Width="28" Height="28"
                        VerticalAlignment="Center" HorizontalAlignment="Center"
                        Background="Transparent" BorderBrush="Transparent"
                        Click="CloseButton_Click">
                    <TextBlock Text="X" HorizontalAlignment="Center" VerticalAlignment="Center" 
                               FontSize="16" Foreground="White" FontWeight="Bold"/>
                    <Button.Styles>
                        <Style Selector="Button:hover">
                            <Setter Property="Background" Value="#444"/> 
                        </Style>
                    </Button.Styles>
                </Button>
                
            </Grid>
        </Border>

        <!-- Main content -->
        <Grid Grid.Row="1">
            <!-- Startup Panel -->
            <StackPanel x:Name="StartupPanel"
            VerticalAlignment="Center"
            HorizontalAlignment="Center"
            Width="800"
            Margin="20"
            Background="Transparent">

            <!-- Nickname label -->
            <TextBlock Text="Enter your nickname:"
                       Foreground="White"
                       Margin="5"
                       HorizontalAlignment="Center"/>

            <!-- Nickname input -->
            <TextBox x:Name="NicknameBox"
                     HorizontalContentAlignment="Center"
                     MaxLength="32"
                     Width="310"
                     Margin="0,5,0,30"
                     Background="Black"
                     Foreground="White"
                     HorizontalAlignment="Stretch"
                     KeyDown="NicknameBox_OnKeyDown"/>

            <!-- Network adapter label -->
            <TextBlock Text="Select network adapter:"
                       HorizontalAlignment="Center"
                       Margin="0,0,0,10"
                       Foreground="White"/>

            <!-- Adapter ComboBox -->
            <ComboBox x:Name="AdapterComboBox"
                      Width="750"
                      Background="Black"
                      Foreground="White"
                      HorizontalContentAlignment="Center"
                      HorizontalAlignment="Center">
                <ComboBox.Styles>
                    <Style Selector="ComboBoxItem">
                        <Setter Property="HorizontalContentAlignment" Value="Center"/>
                    </Style>
                </ComboBox.Styles>
            </ComboBox>

            <!-- Spacer for visual separation -->
            <TextBlock Text="Select port" Margin="10" Foreground="White" HorizontalAlignment="Center"/>

            <!-- Port selector -->
            <NumericUpDown x:Name="PortSelector"
                           Minimum="1"
                           Maximum="65535"
                           Value="29999"
                           Increment="1"
                           Width="135"
                           HorizontalContentAlignment="Center"
                           HorizontalAlignment="Center"
                           Foreground="White"
                           FormatString="0"
                           />


            <!-- Start button -->
            <Button Content="Start Chat"
                    Click="StartChat_Click"
                    HorizontalAlignment="Center"
                    Margin="0,20,0,0"/>

            <!-- Error message -->
            <TextBlock x:Name="ErrorText"
                       Foreground="DarkRed"
                       HorizontalAlignment="Center"
                       TextAlignment="Center"
                       Margin="0,15,0,0"
                       FontSize="16"
                       MaxWidth="750"
                       TextWrapping="Wrap"/>
        </StackPanel>

            
            <!-- Main panel (chat) -->
            <Grid x:Name="ChatPanel" Margin="0,0,0,5" IsVisible="False" RowDefinitions="*,Auto">
                <ScrollViewer Grid.Row="0"
                              x:Name="MessagesScrollViewer"
                              Background="Black"
                              VerticalScrollBarVisibility="Auto"
                              HorizontalScrollBarVisibility="Disabled"
                              Margin="3">
                    <ItemsControl x:Name="MessagesList"
                                  Background="Black"
                                  Foreground="White"
                                  HorizontalAlignment="Stretch"
                                  VerticalAlignment="Stretch">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                    </ItemsControl>
                </ScrollViewer>

                <TextBox Grid.Row="1"
                         x:Name="InputBox"
                         Height="100"
                         MaxLength="900"
                         Width="780"
                         Watermark="Type here to send messages and press enter to send..."
                         Background="Black"
                         Foreground="White"
                         HorizontalAlignment="Stretch"
                         VerticalAlignment="Bottom"
                         Margin="3"
                         TextWrapping="Wrap"
                         KeyDown="InputBox_OnKeyDown"/>
                
            </Grid>
        </Grid>
    </Grid>

    <Window.DataTemplates>
        <DataTemplate DataType="{x:Type gui:ChatMessage}">
            <StackPanel Margin="2">
                <TextBlock Text="{Binding Text}" Foreground="{Binding Color}" TextWrapping="Wrap"/>
            </StackPanel>
        </DataTemplate>
    </Window.DataTemplates>
</Window>
